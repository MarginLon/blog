---
title: 导航守卫
date: 2022-09-01 10:21:21
categories: 
  - 《Vue》
tags: 
  - Vue
author: 
  name: MarginLon
  link: https://github.com/MarginLon
permalink: /pages/0217c7/
---

## 全局守卫

### 全局前置守卫

守卫是异步解析执行，此时导航在所有守卫 resolve 完之前一直处于等待中。

```js
const router = createRouter({ ... })

router.beforeEach((to, from) => {
  // ...
  // 返回 false 以取消导航
  return false
})

router.beforeEach(async (to, from) => {
   if (
     // 检查用户是否已登录
     !isAuthenticated &&
     // ❗️ 避免无限重定向
     to.name !== 'Login'
   ) {
     // 将用户重定向到登录页面
     return { name: 'Login' }
   }
 })
```

### 全局解析守卫

在所有组件内守卫和异步路由组件被解析之后，解析守卫就被正确调用。

```js
router.beforeResolve((to) => {
  if (to.path.startsWith("/blogs")) {
    console.log("用户已登录...");
  }
});
```

### 全局后置钩子

不会接受 next 函数也不会改变导航本身,对于分析、更改页面标题、声明页面等辅助功能以及许多其他事情都很有用。

```js
router.afterEach((to) => {
  document.title = to.path;
});

router.afterEach((to, from, failure) => {
  if (!failure) sendToAnalytics(to.fullPath)
})
```

## 路由守卫

## 组件守卫

## 执行顺序

- 失活组件 **beforeRouteLeave**（如果有）

- 全局 **beforeEach**  

- 复用组件中，执行 **beforeRouteUpdate()**  

- 路由对象的 **beforeEnter**

- 解析异步导航组件

- 组件 **beforeRouteEnter()**

- 全局 **beforeResolve()**

- 确认导航，页面跳转

- 全局 **afterEach**

- 更新DOM节点

- 执行组件 **beforeRouteEnter**中 **next()** 的回调函数
